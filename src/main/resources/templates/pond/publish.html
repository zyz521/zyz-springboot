<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>å‘å¸ƒåŠ¨æ€ - é±¼å¡˜ç¤¾åŒº</title>
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        :root {
            --bg-color: #fff7e0;
            --brand-orange: #ff8a00;
            --brand-gradient: linear-gradient(135deg, #ffb300, #ff8a00);
            --nav-height: 60px;
        }

        body {
            background-color: var(--bg-color);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            padding-bottom: calc(var(--nav-height) + 20px);
        }

        .page-header {
            position: sticky;
            top: 0;
            z-index: 1000;
            background: linear-gradient(120deg, #ffb300, #ff8a00);
            color: #fff;
            padding: 12px 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,.06);
        }

        .page-header-title {
            font-size: 16px;
            font-weight: 600;
        }

        .page-header-sub {
            font-size: 12px;
            opacity: 0.9;
        }

        .publish-card {
            background: #fff;
            border-radius: 18px;
            box-shadow: 0 8px 20px rgba(0,0,0,.06);
            padding: 16px 16px 20px;
            margin-top: 16px;
        }

        .user-chip {
            display: inline-flex;
            align-items: center;
            padding: 4px 10px;
            border-radius: 999px;
            background: #fff7e0;
            color: #ff8a00;
            font-size: 12px;
            margin-bottom: 8px;
        }

        .user-chip span:first-child {
            margin-right: 6px;
        }

        .content-textarea {
            border: none;
            resize: none;
            min-height: 110px;
            font-size: 15px;
            line-height: 1.6;
            padding: 0;
        }

        .content-textarea:focus {
            box-shadow: none;
        }

        .hint-text {
            font-size: 12px;
            color: #999;
        }

        .pill-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 4px;
        }

        .tag-input {
            border-radius: 999px;
            padding-left: 12px;
            padding-right: 12px;
            font-size: 13px;
        }

        .image-upload-area {
            border-radius: 16px;
            border: 1px dashed #ffcc80;
            background: #fffdf5;
            padding: 14px;
            text-align: center;
            cursor: pointer;
        }

        .image-upload-area:hover {
            background: #fff8e1;
        }

        .image-preview-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .image-preview-item {
            width: 80px;
            height: 80px;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            background: #f5f5f5;
        }

        .image-preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .image-remove-btn {
            position: absolute;
            top: 2px;
            right: 2px;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            border: none;
            background: rgba(0,0,0,.45);
            color: #fff;
            font-size: 12px;
            line-height: 18px;
            padding: 0;
        }

        .error-text {
            font-size: 12px;
            color: #ff4d4f;
            margin-top: 6px;
        }

        .submit-btn {
            background: var(--brand-gradient);
            border: none;
            border-radius: 999px;
            padding: 10px 16px;
            font-weight: 600;
            font-size: 15px;
            color: #fff;
            width: 100%;
            box-shadow: 0 4px 12px rgba(255,138,0,.4);
        }

        /* åº•éƒ¨å¯¼èˆªæ ï¼ˆå¸¦æ¶ˆæ¯çº¢ç‚¹ï¼‰ */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: var(--nav-height);
            background-color: #fff;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 1000;
        }

        .bottom-nav-item {
            font-size: 10px;
            color: #999;
            text-align: center;
            text-decoration: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 20%;
            position: relative;
        }

        .bottom-nav-item span:first-child {
            font-size: 20px;
            margin-bottom: 2px;
        }

        .bottom-nav-item.active {
            color: var(--brand-orange);
        }

        .message-badge {
            position: absolute;
            top: 2px;
            right: 50%;
            transform: translateX(18px);
            min-width: 16px;
            height: 16px;
            padding: 0 4px;
            background: #ff4d4f;
            border-radius: 10px;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: #fff;
            font-weight: bold;
            line-height: 16px;
            border: 1px solid #fff;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        .message-badge.show {
            display: flex;
        }
    </style>
</head>
<body>

<div class="page-header">
    <div class="d-flex justify-content-between align-items-center">
        <div>
            <div class="page-header-title">å‘å¸ƒé±¼å¡˜åŠ¨æ€</div>
            <div class="page-header-sub">åˆ†äº«ç”Ÿæ´»ã€æ™’æ™’å¥½ç‰©ï¼Œä¹Ÿå¯ä»¥é¡ºä¾¿å¸¦è´§</div>
        </div>
        <a th:href="@{/pond}" class="text-white small text-decoration-none">è¿”å›é±¼å¡˜</a>
    </div>
</div>

<div class="container" style="max-width: 640px;">
    <div class="publish-card">
        <div class="d-flex justify-content-between align-items-center mb-2">
            <div class="user-chip" th:if="${username != null}">
                <span>ğŸ‘¤</span>
                <span th:text="${username}">æˆ‘</span>
            </div>
            <div class="hint-text ms-auto">
                æ”¯æŒæ–‡å­— + æœ€å¤š 9 å¼ å›¾ç‰‡
            </div>
        </div>

        <form th:action="@{/pond/publish}" method="post" enctype="multipart/form-data" id="pondPublishForm">
            <div class="mb-3">
                <textarea class="form-control content-textarea"
                          name="content"
                          placeholder="è¿™ä¸€åˆ»ä½ æƒ³åˆ†äº«ä»€ä¹ˆï¼Ÿæ”¯æŒè¡¨æƒ…å’Œå¤šè¡Œå†…å®¹ï½"
                          required></textarea>
            </div>

            <div class="row g-2 mb-3">
                <div class="col-6">
                    <div class="pill-label">è¯é¢˜åˆ†ç±»ï¼ˆå¯é€‰ï¼‰</div>
                    <select class="form-select form-select-sm tag-input" name="category">
                        <option value="" selected>ä¸é€‰æ‹©</option>
                        <option value="digital">æ•°ç </option>
                        <option value="photography">æ‘„å½±</option>
                        <option value="acg">äºŒæ¬¡å…ƒ</option>
                        <option value="figure">æ‰‹åŠ</option>
                        <option value="local">åŒåŸ</option>
                    </select>
                </div>
                <div class="col-6">
                    <div class="pill-label">æ‰€åœ¨åŸå¸‚ï¼ˆå¯é€‰ï¼‰</div>
                    <input type="text" class="form-control form-control-sm tag-input"
                           name="city"
                           placeholder="å¦‚ï¼šä¸Šæµ· / æ­å·">
                </div>
            </div>

            <div class="mb-2">
                <div class="pill-label mb-1">å›¾ç‰‡ï¼ˆæœ€å¤š 9 å¼ ï¼‰</div>
                <div class="image-upload-area"
                     onclick="document.getElementById('pondImagesInput').click(); return false;">
                    <div>
                        <div style="font-size: 28px; margin-bottom: 4px;">ğŸ“·</div>
                        <div class="hint-text">ç‚¹å‡»é€‰æ‹©æˆ–é•¿æŒ‰æ‹–å…¥å›¾ç‰‡ï¼Œæ”¯æŒ JPG / PNG / GIFï¼Œå•å¼ ä¸è¶…è¿‡ 5MB</div>
                    </div>
                </div>
                <input id="pondImagesInput"
                       type="file"
                       name="images"
                       accept="image/jpeg,image/jpg,image/png,image/gif"
                       multiple
                       class="d-none">
                <div id="pondImagePreview" class="image-preview-list"></div>
                <div id="pondImageError" class="error-text" style="display:none;"></div>
            </div>

            <div th:if="${error}" class="error-text" th:text="${error}"></div>

            <div class="mt-3">
                <button type="submit" class="submit-btn">å‘å¸ƒåŠ¨æ€</button>
            </div>
        </form>
    </div>
</div>

<script>
    (function () {
        const input = document.getElementById('pondImagesInput');
        const preview = document.getElementById('pondImagePreview');
        const errorDiv = document.getElementById('pondImageError');
        if (!input || !preview) return;

        const maxImages = 9;
        const maxFileSize = 5 * 1024 * 1024;

        function showError(msg) {
            if (!errorDiv) return;
            errorDiv.textContent = msg;
            errorDiv.style.display = 'block';
        }

        function clearError() {
            if (!errorDiv) return;
            errorDiv.textContent = '';
            errorDiv.style.display = 'none';
        }

        input.addEventListener('change', function () {
            clearError();
            const files = Array.from(input.files || []);
            if (files.length > maxImages) {
                showError('æœ€å¤šåªèƒ½é€‰æ‹© ' + maxImages + ' å¼ å›¾ç‰‡');
                input.value = '';
                preview.innerHTML = '';
                return;
            }

            preview.innerHTML = '';

            files.forEach(function (file, index) {
                if (file.size > maxFileSize) {
                    showError('å›¾ç‰‡ "' + file.name + '" è¶…è¿‡ 5MB é™åˆ¶');
                    return;
                }

                const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'];
                if (validTypes.indexOf(file.type) === -1) {
                    showError('å›¾ç‰‡ "' + file.name + '" æ ¼å¼ä¸æ”¯æŒ');
                    return;
                }

                const reader = new FileReader();
                reader.onload = function (e) {
                    const item = document.createElement('div');
                    item.className = 'image-preview-item';
                    item.innerHTML =
                        '<img src="' + e.target.result + '" alt="é¢„è§ˆ">' +
                        '<button type="button" class="image-remove-btn" data-index="' + index + '">Ã—</button>';
                    preview.appendChild(item);
                };
                reader.readAsDataURL(file);
            });

            preview.addEventListener('click', function (e) {
                if (e.target.classList.contains('image-remove-btn')) {
                    const idx = parseInt(e.target.getAttribute('data-index'), 10);
                    const dt = new DataTransfer();
                    Array.from(input.files || []).forEach(function (f, i) {
                        if (i !== idx) dt.items.add(f);
                    });
                    input.files = dt.files;
                    input.dispatchEvent(new Event('change'));
                }
            }, {once: true});
        });
    })();
</script>

</body>
</html>


